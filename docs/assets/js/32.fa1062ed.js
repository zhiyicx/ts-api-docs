(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{383:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"文件存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件存储"}},[t._v("#")]),t._v(" 文件存储")]),t._v(" "),a("h2",{attrs:{id:"厂商标识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#厂商标识"}},[t._v("#")]),t._v(" 厂商标识")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("标识")]),t._v(" "),a("th",[t._v("厂商")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("local")])]),t._v(" "),a("td",[t._v("本地系统")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("aliyun-oss")])]),t._v(" "),a("td",[t._v("阿里云 OSS")])])])]),t._v(" "),a("h2",{attrs:{id:"频道标识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#频道标识"}},[t._v("#")]),t._v(" 频道标识")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("标识")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("public")])]),t._v(" "),a("td",[t._v("用于公开图片，例如用户头像，或者不需要付费的任何图片使用 "),a("code",[t._v("public")]),t._v(" 作为频道")])])])]),t._v(" "),a("h2",{attrs:{id:"创建上传任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建上传任务"}},[t._v("#")]),t._v(" 创建上传任务")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/api/v2/storage\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("请求内容参数：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("filename")])]),t._v(" "),a("td",[a("code",[t._v("string")])]),t._v(" "),a("td",[a("strong",[t._v("必须")]),t._v("，文件原始名称（需要带上文件拓展名）")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("hash")])]),t._v(" "),a("td",[a("code",[t._v("string")])]),t._v(" "),a("td",[a("strong",[t._v("必须")]),t._v("，文件的 MD5 算法进行计算的值，采用 "),a("code",[t._v("32")]),t._v(" 位算法字符")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("size")])]),t._v(" "),a("td",[a("code",[t._v("integer")])]),t._v(" "),a("td",[a("strong",[t._v("必须")]),t._v("，文件内容大小")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("mime_type")])]),t._v(" "),a("td",[a("code",[t._v("string")])]),t._v(" "),a("td",[a("strong",[t._v("必须")]),t._v("，文件 MIME 类型")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("storage")])]),t._v(" "),a("td",[a("code",[t._v("array")])]),t._v(" "),a("td",[a("strong",[t._v("必须")]),t._v("，文件存储信息")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("storage.channel")])]),t._v(" "),a("td",[a("code",[t._v("string")])]),t._v(" "),a("td",[a("strong",[t._v("必须")]),t._v("，允许的「"),a("a",{attrs:{href:"#%E9%A2%91%E9%81%93%E6%A0%87%E8%AF%86"}},[t._v("频道标识")]),t._v("」")])])])]),t._v(" "),a("p",[t._v("响应：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Status: 201 Created\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("div",{staticClass:"language-json5 line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json5"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uri"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://seven-local.oss-cn-beijing.aliyuncs.com/2018/09/05/TxgUMmw25De0t1PCiXkqpMqVAvWFCFFWlNKwd8Xl4V0mxyDvb7ISj0PmTUFH5PJH.png?OSSAccessKeyId=LTAIqgpxMlsPodLB&Expires=1536141182&Signature=EuCsfHaiGnkhDQ4D8wys%2FU7pYtQ%3D"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 上传文件的请求地址")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"method"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PUT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 上传文件的请求方式")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"headers"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 上传文件时候，headers 必须的键值")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Content-Type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"image/png"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"form"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 上传时候的表单，如果是 NULL 则表示整个 Body 是二进制文件流，如果是对象，则构造 `application/form-data` 表单对象")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"file_key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果存在 `form` 表单信息，文件流所使用的 key 名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"node"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"public:2018/09/05/TxgUMmw25De0t1PCiXkqpMqVAvWFCFFWlNKwd8Xl4V0mxyDvb7ISj0PmTUFH5PJH.png"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件上传完成后所使用的文件节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("h2",{attrs:{id:"文件附带信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件附带信息"}},[t._v("#")]),t._v(" 文件附带信息")]),t._v(" "),a("p",[t._v("这里是指使用文件对象的附带信息。例如用户资料种的 "),a("code",[t._v("avatar")]),t._v(" 字段：")]),t._v(" "),a("div",{staticClass:"language-json5 line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json5"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"avatar"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"url"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://127.0.0.1:8000/storage/public:MjAxOC8wOS8wNS9UeGdVTW13MjVEZTB0MVBDaVhrcXBNcVZBdldGQ0ZGV2xOS3dkOFhsNFYwbXh5RHZiN0lTajBQbVRVRkg1UEpILnBuZw=="')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件请求地址，GET 方式")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"vendor"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aliyun-oss"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 厂商名称")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"mime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"image/png"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件 MIME")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"size"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("802930")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件尺寸")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"dimension"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果文件是图片，将返回文件的尺寸信息")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"width"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2800")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 图片宽度")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"height"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1867")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 图片高度")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// ...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("字段")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("url")]),t._v(" "),a("td",[t._v("string")]),t._v(" "),a("td",[t._v("文件请求地址，GET 方式")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("vendor")]),t._v(" "),a("td",[t._v("string")]),t._v(" "),a("td",[t._v("厂商名称")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("mime")]),t._v(" "),a("td",[t._v("string")]),t._v(" "),a("td",[t._v("文件 MIME")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("size")]),t._v(" "),a("td",[t._v("int")]),t._v(" "),a("td",[t._v("文件大小，单位：字节")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("dimension")]),t._v(" "),a("td",[t._v("dictionary")]),t._v(" "),a("td",[t._v("图片尺寸信息")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("dimension.width")]),t._v(" "),a("td",[t._v("double")]),t._v(" "),a("td",[t._v("图片宽度，单位：像素")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("dimension.height")]),t._v(" "),a("td",[t._v("double")]),t._v(" "),a("td",[t._v("图片高度，单位：像素")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("node")]),t._v(" "),a("td",[t._v("string")]),t._v(" "),a("td",[t._v("文件系统中的node")])])])]),t._v(" "),a("h2",{attrs:{id:"文件处理规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件处理规则"}},[t._v("#")]),t._v(" 文件处理规则")]),t._v(" "),a("p",[t._v("文件处理规则是在得到文件请求地址后，使用「查询参数」"),a("code",[t._v("rule")]),t._v(" 进行传递参数。这里的参数是根据 "),a("code",[t._v("vendor")]),t._v(" 自动客户端自行调整的。")]),t._v(" "),a("h3",{attrs:{id:"本地存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地存储"}},[t._v("#")]),t._v(" 本地存储")]),t._v(" "),a("p",[t._v("本地存储仅支持「"),a("strong",[t._v("图片")]),t._v("」处理，其他文件一律不处理。规则如下：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("名称")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("w")])]),t._v(" "),a("td",[a("strong",[t._v("可选")]),t._v("，指定图片宽度")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("h")])]),t._v(" "),a("td",[a("strong",[t._v("可选")]),t._v("，指定图片高度")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("q")])]),t._v(" "),a("td",[a("strong",[t._v("可选")]),t._v("，指定图片质量，"),a("code",[t._v("0")]),t._v(" - "),a("code",[t._v("90")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("b")])]),t._v(" "),a("td",[a("strong",[t._v("可选")]),t._v("，指定图片高斯模糊程度，"),a("code",[t._v("0")]),t._v(" - "),a("code",[t._v("100")])])])])]),t._v(" "),a("p",[t._v("参数和值使用 "),a("code",[t._v("_")]),t._v(" 进行链接，多个参数使用 "),a("code",[t._v(",")]),t._v(" 进行分割，例如指定图片宽度为 200，规则为 "),a("code",[t._v("w_200")]),t._v("，\n多个参数，例如指定宽高和模糊："),a("code",[t._v("w_100,h_100,b_60")]),t._v("。")]),t._v(" "),a("p",[t._v("拼接出来的请求完整 URL 如：")]),t._v(" "),a("div",{staticClass:"language-http request line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("http:")]),t._v("//127.0.0.1:8000/storage/public:MjAxOC8wOS8wNS9UeGdVTW13MjVEZTB0MVBDaVhrcXBNcVZBdldGQ0ZGV2xOS3dkOFhsNFYwbXh5RHZiN0lTajBQbVRVRkg1UEpILnBuZw==?rule=w_100,h_100,b_60\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"其他厂商"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他厂商"}},[t._v("#")]),t._v(" 其他厂商")]),t._v(" "),a("ul",[a("li",[a("a",{ref:"noopener noreferrer",attrs:{href:"https://help.aliyun.com/document_detail/44686.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("阿里云 OSS - 图片处理"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);